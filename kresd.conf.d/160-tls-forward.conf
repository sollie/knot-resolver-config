-- DNS over TLS forwarding

local dc_ca_bundle = '/etc/knot-resolver/ssl/DigiCertECCSecureServerCA.crt'
local google_ca_bundle = '/etc/knot-resolver/ssl/GTS101.pem'

policy.add(policy.slice(
  policy.slice_randomize_psl(),
    policy.TLS_FORWARD({
    -- Cloudflare (https://1.1.1.1)
      {'1.1.1.2', hostname='cloudflare-dns.com', ca_file=dc_ca_bundle},
      {'1.0.0.2', hostname='cloudflare-dns.com', ca_file=dc_ca_bundle},
      {'2606:4700:4700::1112', hostname='cloudflare-dns.com', ca_file=dc_ca_bundle},
      {'2606:4700:4700::1002', hostname='cloudflare-dns.com', ca_file=dc_ca_bundle}
    }),
    policy.TLS_FORWARD({
    -- Quad9 (https://quad9.net)
      {'9.9.9.9', hostname='dns.quad9.net', ca_file=dc_ca_bundle},
      {'149.112.112.112', hostname='dns.quad9.net', ca_file=dc_ca_bundle},
      {'2620:fe::fe', hostname='dns.quad9.net', ca_file=dc_ca_bundle},
      {'2620:fe::9', hostname='dns.quad9.net', ca_file=dc_ca_bundle}
    })
  )
)
